C51 COMPILER V9.60.7.0   WEATHER                                                           07/03/2024 18:31:25 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE WEATHER
OBJECT MODULE PLACED IN .\Objects\weather.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE weather.c LARGE WARNINGLEVEL(1) OPTIMIZE(9,SIZE) BROWSE DEBUG OBJECTEXTE
                    -ND PRINT(.\Listings\weather.lst) TABS(2) OBJECT(.\Objects\weather.obj)

line level    source

   1          #include "weather.h"
   2          #include "oled.h"
   3          #include "keyscan.h"
   4          #include "delay.h"
   5          #include "ds1302.h"
   6          
   7          Weather weather[4];
   8          
   9          void weather_init(){
  10   1        uchar i;
  11   1        for(i=0;i<4;i++){
  12   2          weather[i].month = 0;
  13   2          weather[i].day = 0;
  14   2          weather[i].dayWeather = 0;
  15   2          weather[i].dayTemp = 0;
  16   2          weather[i].nightWeather = 0;
  17   2          weather[i].nightTemp = 0;
  18   2        }
  19   1      }
  20          
  21          void set_weather_from_str(uchar num, char weather_str[13]){
  22   1        weather[num].month = char_to_double_digit(weather_str[0], weather_str[1]);
  23   1        weather[num].day = char_to_double_digit(weather_str[2], weather_str[3]);
  24   1        weather[num].dayWeather = char_to_double_digit(weather_str[4], weather_str[5]);
  25   1        weather[num].dayTemp = char_to_double_digit(weather_str[6], weather_str[7]);
  26   1        weather[num].nightWeather = char_to_double_digit(weather_str[8], weather_str[9]);
  27   1        weather[num].nightTemp = char_to_double_digit(weather_str[10], weather_str[11]);
  28   1      }
  29          
  30          void page_weather_error(){
  31   1        char connect_ble_chinese[] = {43,48,49,50,51}, waiting_chinese[] = {52,53,54,55,4,5,56,57}, press_key_can
             -cel_chinese[] = {58,59,60,61,62,63};
  32   1        OLED_Clear();
  33   1        OLED_ShowChineseString(24,0,0,connect_ble_chinese,5);
  34   1        OLED_ShowChineseString(0,2,0,waiting_chinese,8);
  35   1        OLED_ShowChineseString(16,6,0,press_key_cancel_chinese,6);
  36   1      //  OLED_ShowString(0,0,"Waiting for App",16);
  37   1      //  OLED_ShowString(0,4,"Press any key",16);
  38   1      //  OLED_ShowString(0,6,"to cancel",16);
  39   1        while(1){
  40   2          if(weather[0].month != 0 && weather[0].day != 0) break;
  41   2          else if(getKey()){
  42   3            OLED_Clear();
  43   3            break;
  44   3          }
  45   2        }
  46   1      }
  47          
  48          void print_weather_all(uchar page){
  49   1        char day_chinese[] = {64,4}, night_chinese[] = {65,25};
  50   1        uchar dayWeather_str[] = {0,1}, nightWeather_str[] = {0,1};
  51   1        char date_to_show[] = "--/--", dayTemp_to_show[] = "--C", nightTemp_to_show[] = "--C";
  52   1        date_to_show[0] = Char(weather[page-1].month / 10);
  53   1        date_to_show[1] = Char(weather[page-1].month % 10);
C51 COMPILER V9.60.7.0   WEATHER                                                           07/03/2024 18:31:25 PAGE 2   

  54   1        date_to_show[3] = Char(weather[page-1].day / 10);
  55   1        date_to_show[4] = Char(weather[page-1].day % 10);
  56   1        dayWeather_str[0] = weather[page-1].dayWeather*2;
  57   1        dayWeather_str[1] = weather[page-1].dayWeather*2 + 1;
  58   1        nightWeather_str[0] = weather[page-1].nightWeather*2;
  59   1        nightWeather_str[1] = weather[page-1].nightWeather*2 + 1;
  60   1        dayTemp_to_show[0] = Char(weather[page-1].dayTemp / 10);
  61   1        dayTemp_to_show[1] = Char(weather[page-1].dayTemp % 10);
  62   1        nightTemp_to_show[0] = Char(weather[page-1].nightTemp / 10);
  63   1        nightTemp_to_show[1] = Char(weather[page-1].nightTemp % 10);
  64   1        OLED_ShowString(32,0,date_to_show,16);
  65   1        OLED_ShowChineseString(0,2,0,day_chinese,2);
  66   1        OLED_ShowString(32,2,":",16);
  67   1        OLED_ShowChineseString(48,2,3,dayWeather_str,2);
  68   1        OLED_ShowString(80,2,dayTemp_to_show,16);
  69   1        OLED_ShowChineseString(0,4,0,night_chinese,2);
  70   1        OLED_ShowString(32,4,":",16);
  71   1        OLED_ShowChineseString(48,4,3,nightWeather_str,2);
  72   1        OLED_ShowString(80,4,nightTemp_to_show,16);
  73   1      }
  74          
  75          //void print_weather_base_now(uchar x, uchar y){
  76          //  uchar i, weather_str[2] = {0,0};
  77          //  for(i=0;i<4;i++){
  78          //    if(get_integer_month() == weather[i].month && get_integer_day() == weather[i].day){
  79          //      if(get_integer_hour() < 6){
  80          //        if(i-1>=0 && i-1<4){
  81          //          weather_str[0] = weather[i-1].nightWeather*2;
  82          //          weather_str[1] = weather[i-1].nightWeather*2 + 1;
  83          //        }
  84          //      }
  85          //      else if(get_integer_hour() >= 18){
  86          //        weather_str[0] = weather[i].nightWeather*2;
  87          //        weather_str[1] = weather[i].nightWeather*2 + 1;
  88          //      }
  89          //      else{
  90          //        weather_str[0] = weather[i].dayWeather*2;
  91          //        weather_str[1] = weather[i].dayWeather*2 + 1;
  92          //      }
  93          //      OLED_ShowChineseString(x,y,3,weather_str,2);
  94          //    }
  95          //  }
  96          //}
  97          
  98          void page_weather_all(){
  99   1        uchar page = 1;
 100   1        if(weather[0].month == 0 && weather[0].day == 0){
 101   2          page_weather_error();
 102   2          if(weather[0].month == 0 && weather[0].day == 0) return;
 103   2        }
 104   1        OLED_Clear();
 105   1        while(1){
 106   2          print_weather_all(page);
 107   2          if(getKey() == 1){
 108   3            page--;
 109   3            if(page < 1) page = 1;
 110   3          }
 111   2          else if(getKey() == 2){
 112   3            page++;
 113   3            if(page > 4) page = 4;
 114   3          }
 115   2          else if(getKey() == 3){
C51 COMPILER V9.60.7.0   WEATHER                                                           07/03/2024 18:31:25 PAGE 3   

 116   3            OLED_Clear();
 117   3            break;
 118   3          }
 119   2          else if(getKey() == 4){
 120   3            OLED_Clear();
 121   3            break;
 122   3          }
 123   2        }
 124   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1043    ----
   CONSTANT SIZE    =     43    ----
   XDATA SIZE       =     24      47
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
