C51 COMPILER V9.60.7.0   DHT11                                                             06/07/2024 17:41:27 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE DHT11
OBJECT MODULE PLACED IN .\Objects\dht11.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE dht11.c LARGE WARNINGLEVEL(1) OPTIMIZE(9,SIZE) BROWSE DEBUG OBJECTEXTEND
                    - PRINT(.\Listings\dht11.lst) TABS(2) OBJECT(.\Objects\dht11.obj)

line level    source

   1          #include <dht11.h>//头文件
   2          #include "oled.h"
   3          
   4          Sensor sensor;
   5          char dht11_to_show[8];
   6          
   7          //写时序的函数
   8          void DHT11_delay_us(uchar n)
   9          {
  10   1          while (--n);
  11   1      }
  12          
  13          void DHT11_delay_ms(uint z)
  14          {
  15   1          uint i, j;
  16   1          for (i = z; i > 0; i--)
  17   1              for (j = 122; j > 0; j--);
  18   1      }
  19          
  20          /*------------------------------------------------
  21                        DHT11开始信号
  22          ------------------------------------------------*/
  23          void DHT11_start() {
  24   1        Data = 1;
  25   1        DHT11_delay_us(2);
  26   1        Data = 0;
  27   1        DHT11_delay_ms(20);   //延时18ms以上
  28   1        Data = 1;
  29   1        DHT11_delay_us(30);
  30   1      }
  31          
  32          /*------------------------------------------------
  33                        接收八位二进制
  34          ------------------------------------------------*/
  35          uchar DHT11_rec_byte()
  36          {
  37   1          uchar i, dat = 0;
  38   1          for (i = 0; i < 8; i++)
  39   1          {
  40   2              while (!Data);
  41   2              DHT11_delay_us(8);
  42   2              dat <<= 1;
  43   2              if (Data == 1)
  44   2                  dat += 1;
  45   2              while (Data);
  46   2          }
  47   1          return dat;
  48   1      }
  49          
  50          /*------------------------------------------------
  51                        接收40bit数据
  52          ------------------------------------------------*/
  53          void getdata(uchar *sensordata) {    //接收40位的数据
  54   1        uchar R_H, R_L, T_H, T_L, revise;
C51 COMPILER V9.60.7.0   DHT11                                                             06/07/2024 17:41:27 PAGE 2   

  55   1        DHT11_start();
  56   1      
  57   1        if (Data == 0) {
  58   2      
  59   2          while (Data == 0); //等待拉高
  60   2      
  61   2          DHT11_delay_us(40);  //拉高后延时80us
  62   2          R_H = DHT11_rec_byte();  //接收湿度高八位
  63   2          R_L = DHT11_rec_byte();  //接收湿度低八位
  64   2          T_H = DHT11_rec_byte();  //接收温度高八位
  65   2          T_L = DHT11_rec_byte();  //接收温度低八位
  66   2          revise = DHT11_rec_byte(); //接收校正位
  67   2      
  68   2          DHT11_delay_us(25);    //结束
  69   2      
  70   2          sensordata[0] = T_H;
  71   2          sensordata[1] = R_H;
  72   2      
  73   2        }
  74   1      }
  75          
  76          void print_temp_and_hum(uchar x, uchar y){
  77   1        getdata((uchar *)&sensor);
  78   1        dht11_to_show[0] = (char)(sensor.temper / 10 + '0');
  79   1        dht11_to_show[1] = (char)(sensor.temper % 10 + '0');
  80   1        dht11_to_show[2] = 'C';
  81   1        dht11_to_show[3] = ' ';
  82   1        dht11_to_show[4] = (char)(sensor.humid / 10 + '0');
  83   1        dht11_to_show[5] = (char)(sensor.humid % 10 + '0');
  84   1        dht11_to_show[6] = '%';
  85   1        dht11_to_show[7] = 0;
  86   1        OLED_ShowString(x,y, dht11_to_show,12);
  87   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    244    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     10       6
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
