C51 COMPILER V9.60.7.0   DHT11                                                             07/04/2024 20:55:10 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE DHT11
OBJECT MODULE PLACED IN .\Objects\dht11.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE dht11.c LARGE WARNINGLEVEL(1) OPTIMIZE(9,SIZE) BROWSE DEBUG OBJECTEXTEND
                    - PRINT(.\Listings\dht11.lst) TABS(2) OBJECT(.\Objects\dht11.obj)

line level    source

   1          #include "dht11.h"//头文件
   2          #include "oled.h"
   3          #include "delay.h"
   4          
   5          const unsigned char code C8x8[] = {0x00,0x06,0x38,0x44,0x42,0x42,0x04,0x00};
   6          uchar dht11_enabled = 1;
   7          Sensor sensor;
   8          sbit LED=P0^0;
   9          
  10          //写时序的函数
  11          void DHT11_delay_us(uchar n)
  12          {
  13   1          while (--n);
  14   1      }
  15          
  16          void DHT11_delay_ms(uint z)
  17          {
  18   1          uint i, j;
  19   1          for (i = z; i > 0; i--)
  20   1              for (j = 122; j > 0; j--);
  21   1      }
  22          
  23          /*------------------------------------------------
  24                        DHT11开始信号
  25          ------------------------------------------------*/
  26          void DHT11_start() {
  27   1        Data = 1;
  28   1        DHT11_delay_us(2);
  29   1        Data = 0;
  30   1        DHT11_delay_ms(20);   //延时18ms以上
  31   1        Data = 1;
  32   1        DHT11_delay_us(30);
  33   1      }
  34          
  35          /*------------------------------------------------
  36                        接收八位二进制
  37          ------------------------------------------------*/
  38          uchar DHT11_rec_byte()
  39          {
  40   1          uchar i, dat = 0;
  41   1          for (i = 0; i < 8; i++)
  42   1          {
  43   2              while (!Data);
  44   2              DHT11_delay_us(8);
  45   2              dat <<= 1;
  46   2              if (Data == 1)
  47   2                  dat += 1;
  48   2              while (Data);
  49   2          }
  50   1          return dat;
  51   1      }
  52          
  53          /*------------------------------------------------
  54                        接收40bit数据
C51 COMPILER V9.60.7.0   DHT11                                                             07/04/2024 20:55:10 PAGE 2   

  55          ------------------------------------------------*/
  56          uchar wait_ms_for_data(uint ms){
  57   1        uchar j;
  58   1        while(ms--){  
  59   2          for(j=0;j<122;j++) if(Data) return 1;
  60   2          if(Data) return 1;
  61   2        }
  62   1        return 0;
  63   1      }
  64            
  65          uchar getdata(uchar *sensordata) {    //接收40位的数据
  66   1        uchar R_H, R_L, T_H, T_L, revise, i;
  67   1        uint ms = 2000;
  68   1      //  if(!dht11_enabled) return;
  69   1        DHT11_start();
  70   1        if (Data == 0) {
  71   2          if(!wait_ms_for_data(2000)) return 0;
  72   2      //    while (Data == 0); //等待拉高
  73   2          DHT11_delay_us(40);  //拉高后延时80us
  74   2          R_H = DHT11_rec_byte();  //接收湿度高八位
  75   2          R_L = DHT11_rec_byte();  //接收湿度低八位
  76   2          T_H = DHT11_rec_byte();  //接收温度高八位
  77   2          T_L = DHT11_rec_byte();  //接收温度低八位
  78   2          revise = DHT11_rec_byte(); //接收校正位
  79   2      
  80   2          DHT11_delay_us(25);    //结束
  81   2      
  82   2          sensordata[0] = T_H;
  83   2          sensordata[1] = R_H;
  84   2          return 1;
  85   2        }
  86   1        return 0;
  87   1      }
  88          
  89          uchar dht11_try_catch_data(){
  90   1        if(getdata((uchar *)&sensor)){
  91   2          dht11_enabled = 1;
  92   2          return 1;
  93   2        }
  94   1        else{
  95   2          dht11_enabled = 0;
  96   2          return 0;
  97   2        }
  98   1      }
  99          
 100          void print_temp_and_hum(uchar x, uchar y){
 101   1        char temper_to_show[3] = "--", humid_to_show[] = "--%";
 102   1        uchar i=0;
 103   1        if(!dht11_enabled) return;
 104   1        if(!dht11_try_catch_data()){
 105   2          OLED_ShowString(x,y,"         ",12);
 106   2          return;
 107   2        }
 108   1        double_digit_to_string(sensor.temper, temper_to_show);
 109   1        humid_to_show[0] = Char(sensor.humid / 10);
 110   1        humid_to_show[1] = Char(sensor.humid % 10);
 111   1        humid_to_show[2] = '%';
 112   1        humid_to_show[3] = 0;
 113   1        OLED_ShowString(x,y, temper_to_show,12);
 114   1        OLED_Set_Pos(x+12,y);
 115   1        for(i=0;i<8;i++) OLED_WR_Byte(C8x8[i],OLED_DATA);
 116   1        OLED_ShowString(x+30,y, humid_to_show,12);
C51 COMPILER V9.60.7.0   DHT11                                                             07/04/2024 20:55:10 PAGE 3   

 117   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    469    ----
   CONSTANT SIZE    =     25    ----
   XDATA SIZE       =      3      17
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
